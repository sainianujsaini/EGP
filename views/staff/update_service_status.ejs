<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pending Applications</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles/feedback.css" />
  </head>
  <body style="background: linear-gradient(to top left, #ffffff 0%, #66ccff 100%)">
    <nav class="navbar navbar-expand-lg fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand me-auto" href="#">Logo</a>
        <div
          class="offcanvas offcanvas-end"
          tabindex="-1"
          id="offcanvasNavbar"
          aria-labelledby="offcanvasNavbarLabel"
        >
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Logo</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="offcanvas"
              aria-label="Close"
            ></button>
          </div>
          <div class="offcanvas-body">
            <ul class="navbar-nav justify-content-center flex-grow-1 pe-3">
              <li class="nav-item">
                <a class="nav-link mx-lg-2 active" aria-current="page" href="#">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link mx-lg-2" href="#about">About Us</a>
              </li>
              <li class="nav-item">
                <a class="nav-link mx-lg-2" href="#services">Services</a>
              </li>
              <li class="nav-item">
                <a class="nav-link mx-lg-2" href="#feedback">Feedback/Suggestion</a>
              </li>
              <li class="nav-item">
                <a class="nav-link mx-lg-2" href="#help">Help</a>
              </li>
              <li class="nav-item">
                <a class="nav-link mx-lg-2" href="#contact">Contact Us</a>
              </li>
            </ul>
          </div>
        </div>
        <a href="#" class="login-button">Login</a>
        <button
          class="navbar-toggler pe-0"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasNavbar"
          aria-controls="offcanvasNavbar"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container" style="margin-top: 80px;">
      <div class="main-content">

        <!-- Electricity Issue Applications -->
        <% if (locals.electricity && locals.electricity.length > 0) { %>
        <div class="table-responsive mb-4">
          <h2>Electricity Issue Applications</h2>
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>S.No</th>
                <th>Application No</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Meter No.</th>
                <th>Issue Type</th>
                <th>Details</th>
                <th>Current Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="electricity-applications">
              <% for (var i = 0; i < electricity.length; i++) { %>
              <tr data-application-id="<%= electricity[i].application_no %>">
                <td><%= i + 1 %></td>
                <td><%= electricity[i].application_no %></td>
                <td><%= electricity[i].first_name %></td>
                <td><%= electricity[i].last_name %></td>
                <td><%= electricity[i].meter_number %></td>
                <td><%= electricity[i].issue_type %></td>
                <td><%= electricity[i].reason %></td>
                <td>
                  <select class="form-select status-select">
                    <option value="Pending" selected>Pending</option>
                    <option value="Approved">Approve</option>
                    <option value="Rejected">Reject</option>
                  </select>
                </td>
                <td>
                  <button class="btn btn-success update-btn">Update</button>
                </td>
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>
        <% } %>

        <!-- Loan Service Applications -->
        <% if (locals.loan && locals.loan.length > 0) { %>
        <div class="table-responsive mb-4">
          <h2>Loan Service Applications</h2>
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>S.No</th>
                <th>Application No</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Annual Income</th>
                <th>Property Value</th>
                <th>Loan Amount</th>
                <th>Reason</th>
                <th>Current Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="loan-applications">
              <% for (var i = 0; i < loan.length; i++) { %>
              <tr data-application-id="<%= loan[i].application_no %>">
                <td><%= i + 1 %></td>
                <td><%= loan[i].application_no %></td>
                <td><%= loan[i].first_name %></td>
                <td><%= loan[i].last_name %></td>
                <td><%= loan[i].income %></td>
                <td><%= loan[i].property_amount %></td>
                <td><%= loan[i].loan_amount %></td>
                <td><%= loan[i].reason %></td>
                <td>
                  <select class="form-select status-select">
                    <option value="Pending" selected>Pending</option>
                    <option value="Approved">Approve</option>
                    <option value="Rejected">Reject</option>
                  </select>
                </td>
                <td>
                  <button class="btn btn-success update-btn">Update</button>
                </td>
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>
        <% } %>

        <!-- Scholarship Applications -->
        <% if (locals.scholarship && locals.scholarship.length > 0) { %>
        <div class="table-responsive mb-4">
          <h2>Scholarship Applications</h2>
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>S.No</th>
                <th>Application No</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Course Name</th>
                <th>Institute Name</th>
                <th>Academic Year</th>
                <th>Scholarship Amount</th>
                <th>Reason</th>
                <th>Current Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="scholarship-applications">
              <% for (var i = 0; i < scholarship.length; i++) { %>
              <tr data-application-id="<%= scholarship[i].application_no %>">
                <td><%= i + 1 %></td>
                <td><%= scholarship[i].application_no %></td>
                <td><%= scholarship[i].first_name %></td>
                <td><%= scholarship[i].last_name %></td>
                <td><%= scholarship[i].course_name %></td>
                <td><%= scholarship[i].institute_name %></td>
                <td><%= scholarship[i].academic_year %></td>
                <td><%= scholarship[i].scholarship_amount %></td>
                <td><%= scholarship[i].reason %></td>
                <td>
                  <select class="form-select status-select">
                    <option value="Pending" selected>Pending</option>
                    <option value="Approved">Approve</option>
                    <option value="Rejected">Reject</option>
                  </select>
                </td>
                <td>
                  <button class="btn btn-success update-btn">Update</button>
                </td>
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>
        <% } %>

        <!-- Voter ID Applications -->
        <% if (locals.voterID && locals.voterID.length > 0) { %>
        <div class="table-responsive mb-4">
          <h2>Voter ID Applications</h2>
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>S.No</th>
                  <th>Application No</th>
                  <th>First Name</th>
                  <th>Last Name</th>
                  <th>Phone No.</th>
                  <th>Date Of Birth</th>
                  <th>Issue</th>
                  <th>Current Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="voterID-applications">
                <% for (var i = 0; i < voterID.length; i++) { %>
                <tr data-application-id="<%= voterID[i].application_no %>">
                  <td><%= i + 1 %></td>
                  <td><%= voterID[i].application_no %></td>
                  <td><%= voterID[i].first_name %></td>
                  <td><%= voterID[i].last_name %></td>
                  <td><%= voterID[i].phone_number %></td>
                  <td><%= voterID[i].date_of_birth %></td>
                  <td><%= voterID[i].reason %></td>
                  <td>
                    <select class="form-select status-select">
                      <option value="Pending" selected>Pending</option>
                      <option value="Approved">Approve</option>
                      <option value="Rejected">Reject</option>
                    </select>
                  </td>
                  <td>
                    <button class="btn btn-success update-btn">Update</button>
                  </td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
          <% } %>
  
          <!-- Shop License Applications -->
          <% if (locals.shopLicense && locals.shopLicense.length > 0) { %>
          <div class="table-responsive mb-4">
            <h2>Shop License Applications</h2>
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>S.No</th>
                  <th>Application No</th>
                  <th>First Name</th>
                  <th>Last Name</th>
                  <th>Shop Name</th>
                  <th>Shop Address</th>
                  <th>License Type</th>
                  <th>Current Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="shopLicense-applications">
                <% for (var i = 0; i < shopLicense.length; i++) { %>
                <tr data-application-id="<%= shopLicense[i].application_no %>">
                  <td><%= i + 1 %></td>
                  <td><%= shopLicense[i].application_no %></td>
                  <td><%= shopLicense[i].first_name %></td>
                  <td><%= shopLicense[i].last_name %></td>
                  <td><%= shopLicense[i].shop_name %></td>
                  <td><%= shopLicense[i].shop_address %></td>
                  <td><%= shopLicense[i].shop_type %></td>
                  <td>
                    <select class="form-select status-select">
                      <option value="Pending" selected>Pending</option>
                      <option value="Approved">Approve</option>
                      <option value="Rejected">Reject</option>
                    </select>
                  </td>
                  <td>
                    <button class="btn btn-success update-btn">Update</button>
                  </td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
          <% } %>
  
          <!-- Caste Certificate Applications -->
          <% if (locals.casteCertificate && locals.casteCertificate.length > 0) { %>
          <div class="table-responsive mb-4">
            <h2>Caste Certificate Applications</h2>
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>S.No</th>
                  <th>Application No</th>
                  <th>First Name</th>
                  <th>Last Name</th>
                  <th>Phone No.</th>
                  <th>Caste</th>
                  <th>Reason</th>
                  <th>Current Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="casteCertificate-applications">
                <% for (var i = 0; i < casteCertificate.length; i++) { %>
                <tr data-application-id="<%= casteCertificate[i].application_no %>">
                  <td><%= i + 1 %></td>
                  <td><%= casteCertificate[i].application_no %></td>
                  <td><%= casteCertificate[i].first_name %></td>
                  <td><%= casteCertificate[i].last_name %></td>
                  <td><%= casteCertificate[i].phone_number %></td>
                  <td><%= casteCertificate[i].caste %></td>
                  <td><%= casteCertificate[i].reason %></td>
                  <td>
                    <select class="form-select status-select">
                      <option value="Pending" selected>Pending</option>
                      <option value="Approved">Approve</option>
                      <option value="Rejected">Reject</option>
                    </select>
                  </td>
                  <td>
                    <button class="btn btn-success update-btn">Update</button>
                  </td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
          <% } %>
  
        </div>
      </div>
  
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      <script>
        // Add event listeners to all buttons with the class 'update-btn'
        document.querySelectorAll('.update-btn').forEach(button => {
          button.addEventListener('click', function() {
            // Find the closest table row (<tr>) to the clicked button
            const row = this.closest('tr');
            // Get the application ID from the 'data-application-id' attribute of the row
            const applicationId = row.getAttribute('data-application-id');
            // Get the new status value from the select dropdown inside the row
            const newStatus = row.querySelector('.status-select').value;
      
            console.log(`Application ID: ${applicationId}, New Status: ${newStatus}`);
      
            // Make an AJAX request to update the status in the backend using Axios
            axios.post('/update-status', {
              applicationId: applicationId,
              status: newStatus
            })
            .then(response => {
              // If the backend responds with success
              if (response.data.success) {
                alert('Status updated successfully.');
                
                // Remove the row from the table
                row.remove(); // This line removes the row from the table
              } else {
                alert('Failed to update status. Please try again.');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              alert('An error occurred. Please try again.');
            });
          });
        });
      </script>
      

    </body>
  </html>
  
